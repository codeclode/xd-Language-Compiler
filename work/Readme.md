# 编译原理上机

## 用啥实现

### TS

> ~~为什么选择 ts，因为它就在那里~~

用 java 画图，我是不是还得学 swing 这玩意。。。

用 python。。。这玩意对我来说就是爬虫＋数学分析，真不熟

c 和 c++，😅

TS：html实现图形化，input 设置点大小和颜色，canvas 画图

那为啥不用 JS：enum 啥的 js 还是不行，~~其实主要是 js 没提示很难受~~

反正以后都在拥抱 ts，那我就当复习了

## 怎么实现

### 分析

- 乍一看这个玩意挺复杂，但是仔细一看——就 5 种语句，而且很死板
  - 设置源点
  - 设置缩放
  - 设置旋转
  - 循环画图，唯一一个麻烦的
  - 注释
  - 加了个颜色设置
- 解释器啊，读一句做一句
- 词法分析器要干啥：读取输入的字符串，把能解析出来的东西变成定义好的 token 对象，传递给语法分析器使用。
- 语法分析器：总共就五条句子，直接硬编码匹配句型就行，唯一麻烦的就是表达式分析。
- 语义分析：真正往 canvas 上画画的东西，为了方便读一句做一句直接继承语法分析器。
- 最顶层 main 方法：传递输入字符串。
- index.ts：获取 inputarea 的输入内容。

### 项目结构

> Scanner 目录
>
> > 针对 Func 类别的 Token 给出的六个函数，作为对 Func 接口的实现，
> >
> > 有 ln、sin、cos、tan、sqrt、exp
> >
> > Func：定义 Func 接口，因为允许用户使用 Cos、sin 等函数绘图，所以提供对此类函数的封装
>>
> > Scanner：词法分析器的主体
>>
> > Token_Table：为一些常量和关键字提供的查询表
> >
> > Token_Type：给出所有可以出现在输入中的记号类型
> >
> > Token：类，给出一个 Token 的基本组成，不过主义 lexme（关键字）、value、func 都是非必要内容，根据 token_type 具体分析。
> 
> Parser 目录
> 
> > CaseParmPtr：如果表达式为变量结点，我们就创建这么个玩意来实现变量值的读写。
>>
> > treeNode：~~其实这玩意只用在了算数表达式上，毕竟语句只需要不断匹配 token 就行~~语法树上的结点，存储操作类型（四种可能——常量、变量、函数、操作符），注意我们提供的函数都是只有一个操作数，所以函数里边有一个结点，而操作符都是二元的（+-\*/\*\*）。注意这里不支持括号有限匹配，主要是太麻烦。
>>
> > ParseInterface+ParseImpl：语法分析器的接口和实现
> 
> Semantic 目录：
>
> > Semantic： Draw 和 Parser 的中间层，把获得的语法和 Draw 类进行翻译。
>>
> > Draw：和 canvas 直接对话，真正提供绘画能力

## 实验总结

- 中间遇到了诸多问题，由于考虑步骤出现了浏览器跑满 CPU 的情况，检查以后发现是死循环+console.error 的问题，于是遇到错误情况直接放弃执行。

- 首先，虽然 ts 原生支持正则表达式，但是这个程序不用正则表达反而更简单
- 对我来说，这个大作业最好的收获就是复习了 ts，也方便了我后来用 tsx。
- 当然，最难的地方自然是递归下降分析程序。头脑风暴 🤔。。
- 和以前读 Vue 源码的模板编译和生成的 ast 语法树不同，毕竟 html 自己就是树形结构 😂。
- canvas 的实现绘画可能不大好用，其实一开始可以考虑用 Svg 绘制会更简单一些。
